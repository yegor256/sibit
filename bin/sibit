#!/usr/bin/env ruby
# frozen_string_literal: true

# SPDX-FileCopyrightText: Copyright (c) 2019-2026 Yegor Bugayenko
# SPDX-License-Identifier: MIT

$stdout.sync = true

require 'backtrace'
require 'loog'
require_relative '../lib/sibit'
require_relative '../lib/sibit/bin'
require_relative '../lib/sibit/http'
require_relative '../lib/sibit/httpproxy'
require_relative '../lib/sibit/bitcoinchain'
require_relative '../lib/sibit/blockchain'
require_relative '../lib/sibit/blockchair'
require_relative '../lib/sibit/btc'
require_relative '../lib/sibit/cex'
require_relative '../lib/sibit/dry'
require_relative '../lib/sibit/fake'
require_relative '../lib/sibit/firstof'
require_relative '../lib/sibit/version'

if __FILE__ == $PROGRAM_NAME
  begin
    Sibit::Bin.start(ARGV)
  rescue StandardError => e
    verbose = !ARGV.include?('--quiet') &&
              (ARGV.include?('--verbose') || ENV.fetch('SIBIT_VERBOSE', nil))
    log = verbose ? Loog::VERBOSE : Loog::REGULAR
    if verbose
      log.error(Backtrace.new(e))
    else
      log.error(e.message)
    end
    exit(255)
  end
end
